package dynamicagent;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
/**
 * 因为装饰者模式有弊端(当一个被装饰的类有很多方法时一个一个实现很麻烦)
 * 所以我们采用动态代理模式(我们手动的让jdk在内存里创建装饰类)
 * 
 */
import java.lang.reflect.Proxy;

public class TestCar {
	public static void main(String[] args) {
		Icar car = (Icar) Proxy.newProxyInstance(TestCar.class.getClassLoader(), GoogleCar.class.getInterfaces(), new InvocationHandler(){
			
			@Override
			public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
				//method代表当前正在执行的每个方法
				
				if(method.getName().equalsIgnoreCase("start")){
					System.out.println("检查天气是否良好");
					method.invoke(new GoogleCar(), args);
					System.out.println("检查路况是否拥堵");
				}
				method.invoke(new GoogleCar(), args);
				return null;
			}
		});
		car.start();
		car.run();
		car.stop();
	}
}
